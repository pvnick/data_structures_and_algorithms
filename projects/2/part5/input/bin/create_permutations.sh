#!/bin/ksh

ORIG_DIR="$(pwd)"
MY_DIR=`dirname $0`

. "$MY_DIR/../common.inc"

INPUT_FILE_PATH="$ORIG_DIR/$1"
INPUT_FILE_NAME=""$(basename "$INPUT_FILE_PATH")""
NUM_PERMUTATIONS="$2"
PERMUTATIONS_DIR="$MY_DIR/../data/permutations"
PERMUTATIONS_BASE_PATH="$PERMUTATIONS_DIR/$INPUT_FILE_NAME"
rm "$PERMUTATIONS_DIR/$INPUT_FILE_NAME"*

count_keys "$INPUT_FILE_PATH"
NUM_KEYS="$RET"
PREV_INPUT_PATH="$INPUT_FILE_PATH"
for PERMUTATION in {1..$NUM_PERMUTATIONS}; do
	PERMUTATION_OUTPUT_PATH="$PERMUTATIONS_BASE_PATH-$PERMUTATION"
	cat "$PREV_INPUT_PATH" | "$MY_DIR/randomize" $NUM_KEYS > "$PERMUTATIONS_BASE_PATH-$PERMUTATION"
	PREV_INPUT_PATH="$PERMUTATION_OUTPUT_PATH"
done